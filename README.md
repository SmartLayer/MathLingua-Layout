# MathLingua-Layout: An XKB Keyboard Layout for Math-Symbol Typing Ployglots

Welcome to the MathLingua-Layout repository. This project is dedicated to providing a unique keyboard layout tailored for Linux users, specifically for the XKB system. Our layout is designed to bridge the gap between mathematical typing, multi-lingual capabilities, and the familiarity of the standard US keyboard layout.

## The Problem

While there are numerous keyboard layouts optimized for polyglot European users, especially those from Western Europe, many of these layouts deviate significantly from the standard US keyboard. This deviation often requires users to unlearn and relearn key placements, leading to inefficiencies and frustrations. Furthermore, many existing keyboards offer mathematical capabilities but lack multi-lingual support such as typing in Italian. This limitation is particularly glaring given Italy's rich history as the birthplace of European mathematics during the Renaissance.

## The Solution

MathLingua-Layout is our answer to these challenges. At its core, it retains the intuitive design of the US keyboard, ensuring that users don't have to unlearn anything. Every symbol and letter functions exactly like the US keyboard. However, it goes beyond by offering up to seven levels of key functions, allowing for a vast array of symbols and characters. This is a significant enhancement over most layouts which typically offer a maximum of four levels.

![The layout of a seven level keyboard](layout.png)

## Introduction

This layout is a modification of the "English (intl., with AltGr dead keys)" keyboard layout, originally developed by Microsoft. It's optimized for typing mathematical symbols and expressions without compromising the original layout's multi-lingual capabilities[^microsoft]. The layout is designed as a diff file against the `/usr/share/X11/xkb/symbols/us` file that comes with Ubuntu, replacing the "English (intl., with AltGr dead keys)" layout directly. The repository is updated with every Ubuntu LTS release.

[^microsoft]: The "English (intl., with AltGr dead keys)" layout, originally developed by Microsoft, enables typing in virtually any Latin-based script. It is specifically optimized for Spanish and French, designed to minimize the use of dead keys. Only a few words, such as "biling√ºe" (bilingual in Spanish), require the use of dead keys. 

## Features

- **No unlearning**: No symbol changed from the popular US English QWERTY layout.
- **Seven-Level Keyboard**: Most keys can produce up to seven distinct symbols, organized into four columns.
- **Currencies**: Enhanced currency support including the Euro (‚Ç¨) and Bitcoin (‚Çø) symbols.
- **Greek Letters**: Incorporates frequently used Greek letters like Œ± and Œæ, more to come.
- **Italic Letters**: Introduces an Italic variant for every English alphabet letter, represented in Unicode. Used in "let ùë• be 0".
- **Subscript & Superscript**: Offers superscript digits, letters, and operators, plus subscript digits.
- **Additional Symbols**: Incorporates a range of symbols from slashes to note symbols, catering to diverse typing needs.

This is a seven-level keyboard, meaning that each key on the keyboard can produce up to seven symbols.

These symbols are organized into 4 columns. The first column of symbols is generated by either directly pressing the key or using the Shift modifier. The second column is accessed by holding the AltGr key, or AltGr in combination with Shift. The third column is produced by holding the Super key (commonly the Windows key on most keyboards) or using Super in conjunction with Shift. The last column is produced by holding the Super Key in conjuction wiht AltGr key. These are superscript A-Z symbols. There is no key defined for the 8th level, that is Super, AltGr and Shift combined.

## Usage

| Symbol Name                  | How to Type Them                      | Examples                                                           |
|-----------------------------|---------------------------------------|----------------------------------------------------------------------|
| Euro Sign (‚Ç¨)               | <kbd>AltGr</kbd> + <kbd>4</kbd>         | "The price is ‚Ç¨50."                                                  |
| Bitcoin (‚Çø)                 | <kbd>AltGr</kbd> + <kbd>Shift</kbd> + <kbd>4</kbd> | "The current value of Bitcoin is ‚Çø1 = $40,000."                       |
| Greek Letters (Œ±, Œæ)        | (Based on key mapping)                | "The angle Œ± is 60¬∞." "The variable Œæ represents..."                  |
| Italic Letters (e.g., ùëõ)    | <kbd>Super</kbd> + [letter]           | "Let ùëõ be the number of elements."                                   |
| Subscript Digits            | <kbd>Super</kbd> + [digit]            | "The chemical formula is H‚ÇÇO."                                       |
| Superscript Numbers (e.g., ‚Å¥)| <kbd>Shift</kbd> + <kbd>Super</kbd> + [digit] | "The value is ùë•‚Å¥."                                                   |
| Superscript Letters         | <kbd>Shift</kbd> + <kbd>Super</kbd> + [letter] | "The variable ùë¶·µÉ represents..."                                      |
| Fractional Slash (‚ÅÑ)        | <kbd>AltGr</kbd> + <kbd>Shift</kbd> + <kbd>1</kbd> | "The ratio is 1‚ÅÑ4." "The fraction 1‚ÅÑ7 represents..."                    |
| Note Symbols‚Ä† (‚Ä†, ‚Ä°, ¬ß, ‚Äñ, ¬∂)| (Based on key mapping)                | "Refer to the note‚Ä†." "See the section‚Ä°." "Paragraph starts with¬∂."  |
| Numero Symbol (‚Ññ)          | <kbd>Win</kbd> + <kbd>Shift</kbd> + <kbd>\\</kbd> | "Product ‚Ññ12345."                                                    |
| Cardinal Signs (¬∫, ¬™)       | <kbd>Win</kbd> + <kbd>Shift</kbd> + <kbd>-</kbd> and <kbd>Win</kbd> + <kbd>-</kbd> | "1¬∫ lugar." "2¬™ posici√≥n."                                          |
| Degree Sign (¬∞)             | <kdb>AltGr</kbd> + <kbd>Shift</kbd> + <kbd>0</kbd>                | "The temperature is 25¬∞." "Calle Mayor 10¬∞, Madrid."                 |

‚Ä† **Note Symbols**: The first four traditional order of [note symbols](https://en.wikipedia.org/wiki/Note_(typography)) in English have been added. The traditional order of these symbols in English is [*](https://en.wikipedia.org/wiki/Asterisk), [‚Ä†](https://en.wikipedia.org/wiki/Dagger_(typography)), [‚Ä°](https://en.wikipedia.org/wiki/Double_dagger_(typography)), [¬ß](https://en.wikipedia.org/wiki/Section_sign), [‚Äñ](https://en.wikipedia.org/wiki/Vertical_Bar), [¬∂](https://en.wikipedia.org/wiki/Pilcrow). The first exists on standard keyboards, the section sign ¬ß and the pilcrow sign ¬∂ existed in "English (intl., with AltGr dead keys)", this project piles the rest 3 symbols on the backslash key.

## Installation

For Ubuntu 23.04:
1. Replace `/usr/share/X11/xkb/symbols/us` with `ubuntu-23.04.us`.
2. In X11, select the "English (intl., with AltGr dead keys)" layout.
3. For Wayland users, configure the layout within your Wayland compositor settings.

This layout supersedes the original "English (intl., with AltGr dead keys)". While a dedicated OS package would be ideal, none currently exists. For other Linux versions or X11, apply `ubuntu-23.04.diff` to `/usr/share/X11/xkb/symbols/us` using the patch command.

## Additional Configuration for Small Keyboards

### 1. Swap ESC key and the tile key with `swap_esc_tlde.diff` ###

For keyboards with a limited number of keys (63 keys), where the upper-left key is often assigned to ESC instead of tilde, you may prefer to have the tilde key for its use in vim and command line operations. To change the ESC key to a tilde, add the following to the section "English (intl., with AltGr dead keys)":

```bash
key <ESC> { [    grave, asciitilde,  dead_grave,   dead_tilde, Escape ] };
```

This layout is designed to enhance the typing experience for users frequently working with mathematical symbols and expressions. Your feedback and suggestions for improvement are always welcome.

### 2. Use the CAPS key as ISO_Level5_Shift with `swap_caps_level5_shift.diff`

In this project, we remapped LWIN key (Left Windows) to ISO_Level5_Shift. If your keyboard lacks a WIN key,  you can repurpose the CAPS key to serve as `ISO_Level5_Shift` using a feature called tap-hold pattern, which means a key function differently when it is tapped then when it is held in combination of another key. You can do so through 2 simple steps, 

1. **Remap the CAPS Key**: Add the following to `/usr/share/X11/xkb/symbols/us`:
   ```
   // Map CAPS to ISO_Level5_Shift and let someone else play Caps_Lock
   key <CAPS> { [ ISO_Level5_Shift ] };
   key <RWIN> { [ Caps_Lock ] };
   ```

2. **Restore Caps_Lock Function**: Execute the command:
   
   ```
   xcape -e 'ISO_Level5_Shift=Caps_Lock' -t 100
   ```
   in your session manager to revert the `Caps_Lock` function to the CAPS key. You might want to play with the timeout value to find the best number for you.
   

**Special Case: Retaining `SUPER_L` Function**
If you have a Windows key and wish to keep its `SUPER_L` function, remove or comment out the `include "level5(lwin_switch_lock)"` line from the keyboard layout configuration. This line repurposes the Windows key's function.

**Can this be done with a programmable keyboard?**
Instead of mapping LWIN as ISO_Level5_Shift, you might consider program a keyboard to use a special key to do it.

In the file `/usr/share/X11/xkb/keycodes/evdev` on many Linux distributions, you'll find the following mapping:

```   
<LVL5> =   203;
```

This means that keycode 203 corresponds to the LVL5 key in X11. Due to an established offset of +8 between X11 keycodes and Linux driver keycodes (historically set at this value), the actual keycode transmitted by the Linux driver for the LVL5 key would be 195 (`203 - 8`). 

However, I haven't personally tested this approach since I'm not familiar with keyboard firmware programming frameworks like QMK/VIA, and I suspect if it would work, since key 195 is not defined in `linux/include/uapi/linux/input-event-codes.h` at all. It appears no existing keyboard has LVL5 keys, or even if it does the Linux kernel may not recognize an event when it is pressed as USB HID keycode 195 is undefined.

If your keyboard firmware supports a tap-and-hold feature natively, you could program the CAPSLOCK key such that when held, it sends the Linux driver keycode 195. With luck, this may be interpreted by X11 as holding down the LVL5 key. 

## Known Issues

While the layout aims to enhance the typing experience, there are a few known issues and areas for potential improvement:

- **Superscript Minus**: Currently, there is no superscript minus symbol, because muscular and feminine cardinal is where you would expect superscript minus. This is rarely an issue as superscripts are often used for elliptic curve math, which primarily involves addition.
- **Trademark and Registered Symbols**: There are currently no mappings for the 'trademark' or 'registered' symbols. One potential solution is to use `alt+shift+'1'` for the trademark symbol and `alt+shift+'2'` for the registered symbol, as there are two ways to produce superscript brackets.
- **Degree Sign**: There are 2 ways to produce the degree sign (¬∞). Alt+shift+0 typed twice is sufficient for this symbol, so the one on number key 5 is not really needed. This is inherited from "English (intl., with AltGr dead keys)" layout.
- **Unused Alt Key Combinations**: The combinations `alt+g`, `alt+shift+g`, `alt+h`, `alt+shift+h`, and `alt+m` and `alt+shift+m` currently do not produce any special symbols.

These issues are minor and do not significantly impact the overall functionality of the layout. However, they will be considered for future updates and improvements.

## It's a feature, not a bug

- Superscript O **·µí**, and superscript A **·µÉ** can be used for muscular and feminine cardinal **¬∫** and **¬™**, so having all of them on a keyboard layout is appears overdsigned. However, often cardinal numbers have underscores in certain fonts, they are visually not replaceable for each other. People who speaks Spanish or Portuguese can tell.
- Usually capital N followed by muscular cardinal ¬∫, when typed together like this N¬∫, suffices as a substitute of Numero sign ‚Ññ. We kept both anyway because the Numero Sign is special.
- The Latin Alpha (…ë) and Copyright (¬©) symbols have not seen much real life uses. Pity.
- The combination `super+shift+'q'` produces nothing, because there is no Unicode code point for superscript q, it just doesn't exist. Also, nothing happens with `super` plus period or comma.

## Helpful Knowledge

To get the Unicode point of a character, use this command:
````
echo -n "êû•" | iconv -f utf8 -t UTF-32 | hexdump -e '/2 "U+%04X\n"'
U+FEFF
U+0000
U+07A5
U+0001
````
This shows that êû• is U107A5.
